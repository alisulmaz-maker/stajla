<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İlan Detayı - STAJLA</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Detay Sayfasına Özel Modern Stil */
        .detail-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        .sidebar-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: center;
            height: fit-content;
        }
        .main-card {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            text-align: left;
        }
        .profile-pic-xl {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin: 0 auto 20px auto;
            border: 5px solid #FFD43B;
            background-color: #f0f0f0;
        }
        .social-icons a {
            font-size: 1.8rem;
            margin: 0 10px;
            text-decoration: none;
            transition: transform 0.2s;
            display: inline-block;
        }
        .social-icons a:hover { transform: scale(1.2); }
        
        .info-row { margin-bottom: 15px; font-size: 1.05rem; }
        .info-row i { width: 25px; color: #FFD43B; text-align: center; margin-right: 10px; }
        
        @media (max-width: 768px) {
            .detail-layout { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<header class="navbar">
    <div class="left">
        <div id="hamburger-menu"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        <a href="/index.html" class="logo-link"><img src="/img/logo.png" alt="STAJLA" class="logo-img"><span class="logo-text">STAJLA</span></a>
    </div>
    <nav class="nav-links">
        <a href="/index.html" class="desktop-link">Anasayfa</a>
        <a href="/isveren-ilan.html" class="desktop-link">İşveren İlan</a>
        <a href="/ogrenci-ilan.html" class="desktop-link">Öğrenci İlan</a>
        <a href="/iletisim.html" class="desktop-link">İletişim</a>
        <div id="user-nav"><a href="/giris.html">Giriş / Kayıt</a></div>
    </nav>
</header>

<main class="form-page" style="max-width: 1100px;">
    <div id="loading-msg" style="text-align: center;"><h3>Yükleniyor...</h3></div>
    
    <div id="content-area" class="detail-layout" style="display: none;">
        
        <aside class="sidebar-card">
            <div id="detail-img" class="profile-pic-xl"></div>
            <h2 id="detail-name" style="margin-bottom: 5px;"></h2>
            <p id="detail-title-sub" style="color: #666; margin-bottom: 20px;"></p>
            
            <div id="student-actions" style="display: none;">
                <div class="social-icons" id="social-links" style="margin-bottom: 20px;">
                    </div>
                <a id="cv-btn" href="#" target="_blank" class="cta-primary" style="display: block; width: 100%; text-align: center; margin-bottom: 10px;">
                    <i class="fas fa-file-pdf"></i> CV Görüntüle
                </a>
            </div>
            
            <button id="main-action-btn" class="cta-primary" style="width: 100%; margin-top: 10px; background-color: #222; color: #FFD43B;">İletişime Geç</button>
        </aside>

        <section class="main-card">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px;">
                <h3 style="font-size: 1.8rem; margin: 0;">İlan Detayları</h3>
                <span id="detail-badge" style="background-color: #28a745; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: bold;"></span>
            </div>
            
            <div class="info-row"><i class="fas fa-university"></i> <strong id="label-1">Bölüm:</strong> <span id="val-1"></span></div>
            <div class="info-row"><i class="fas fa-map-marker-alt"></i> <strong>Konum:</strong> <span id="val-location"></span></div>
            <div class="info-row"><i class="fas fa-briefcase"></i> <strong>Alan/Sektör:</strong> <span id="val-area"></span></div>

            <hr style="margin: 30px 0; border-top: 1px solid #eee;">

            <h4>Hakkında / Açıklama</h4>
            <p id="detail-desc" style="line-height: 1.8; color: #444; white-space: pre-wrap; margin-top: 15px;"></p>

            <div id="contact-box" style="background: #f9f9f9; padding: 20px; border-left: 4px solid #FFD43B; margin-top: 40px;">
                <strong>İletişim:</strong> <span id="val-contact"></span>
            </div>
        </section>
    </div>
</main>

<footer><p>© 2025 STAJLA</p></footer>

<script src="/js/main.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        const type = params.get('type'); 

        if(!id || !type) return;

        try {
            const response = await fetch(`/api/public-listing-details?id=${id}&type=${type}`);
            const res = await response.json();

            if(res.success) {
                const data = res.listing;
                document.getElementById('loading-msg').style.display = 'none';
                document.getElementById('content-area').style.display = 'grid'; // Göster

                // --- ORTAK ALANLAR ---
                // Profil Resmi
                const imgDiv = document.getElementById('detail-img');
                if (data.profilePicturePath) {
                    imgDiv.style.backgroundImage = `url('${data.profilePicturePath}')`;
                } else {
                    // Placeholder (Baş harf veya ikon)
                    imgDiv.style.display = 'flex'; imgDiv.style.alignItems = 'center'; imgDiv.style.justifyContent = 'center';
                    imgDiv.innerHTML = `<span style="font-size: 3rem; color: #ccc;">${(data.name || data.company || '?').charAt(0)}</span>`;
                }

                // İsim ve Başlık
                document.getElementById('detail-name').textContent = type === 'student' ? data.name : data.company;
                document.getElementById('detail-title-sub').textContent = type === 'student' ? 'Öğrenci / Stajyer Adayı' : 'İşveren / Şirket';

                document.getElementById('val-location').textContent = data.city;
                document.getElementById('val-area').textContent = type === 'student' ? data.area : data.sector;
                document.getElementById('val-contact').textContent = data.contact;

                // Rozet (Staj Türü)
                const badge = document.getElementById('detail-badge');
                if (data.stajTuru) {
                    badge.textContent = data.stajTuru;
                    if(data.stajTuru.includes('Ücretsiz')) badge.style.backgroundColor = '#6c757d';
                } else { badge.style.display = 'none'; }

                // Açıklama
                document.getElementById('detail-desc').textContent = type === 'student' ? data.desc : data.req;

                // --- TİPE ÖZEL ALANLAR ---
                if (type === 'student') {
                    document.getElementById('label-1').textContent = 'Bölüm/Okul:';
                    document.getElementById('val-1').textContent = data.dept;

                    // CV ve Sosyal Linkler (GELİŞTİRME BURADA)
                    document.getElementById('student-actions').style.display = 'block';
                    const socialBox = document.getElementById('social-links');
                    
                    if (data.linkedin) socialBox.innerHTML += `<a href="${data.linkedin}" target="_blank" style="color: #0077b5;"><i class="fab fa-linkedin"></i></a>`;
                    if (data.github) socialBox.innerHTML += `<a href="${data.github}" target="_blank" style="color: #333;"><i class="fab fa-github"></i></a>`;
                    if (data.portfolio) socialBox.innerHTML += `<a href="${data.portfolio}" target="_blank" style="color: #ea4c89;"><i class="fas fa-globe"></i></a>`;

                    const cvBtn = document.getElementById('cv-btn');
                    if (data.cvPath) { cvBtn.href = data.cvPath; } else { cvBtn.style.display = 'none'; }
                    
                    document.getElementById('main-action-btn').textContent = "Bu Adaya Ulaş";
                    document.getElementById('main-action-btn').onclick = () => window.location.href = `mailto:${data.contact}`;

                } else {
                    // İşveren
                    document.getElementById('label-1').textContent = 'Aranan Pozisyon:';
                    document.getElementById('val-1').textContent = data.area;
                    
                    const applyBtn = document.getElementById('main-action-btn');
                    applyBtn.textContent = "Hemen Başvur";
                    applyBtn.style.backgroundColor = "#FFD43B";
                    applyBtn.style.color = "#222";

                    // Başvuru mantığı (main.js'deki currentUser kontrolü burada da olmalı ama basit tutuyoruz)
                    if (currentUser && currentUser.role === 'student') {
                        applyBtn.onclick = async () => {
                           // Basit başvuru yönlendirmesi veya main.js fonksiyonunu tetikleme
                           alert('Başvuru yapmak için Anasayfadaki butonu kullanmanız önerilir.');
                        };
                    }
                }

            }
        } catch(e) {
            document.getElementById('loading-msg').innerHTML = '<p>İlan yüklenirken hata oluştu.</p>';
        }
    });
</script>
</body>
</html>